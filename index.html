<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <script src='js/vue.js'></script>
  <title>snow flake</title>
  <style>
    /*阻止在手机上输入时自动放大*/
    input[type='text'],
    input[type='number'],
    textarea {
      font-size: 16px;
    }
    textarea {
      overflow-y: hidden;
    }
  </style>
</head>
<body>
  <div id="app">
    <side-nav :steps="steps" :selected="selected" @selected="setSelected"></side-nav>
    <div>
      <div class="sec" v-for="(step, index) of steps" v-show="index == selected" :key="index">
        <component
          :is="step.name"
          :desc="step.desc"
          :statistic="step.statistic"
          :content="step.content"
          :index="index"
          :former-content="step.former > -1 ? steps[step.former]['content'] : null"
          @update-content="updateContent"
        >
        </component>
      </div>
    </div>
  </div>

  <script type="x-template" id="type_1">
    <div>
      <hint :desc="desc" :statistic="statistic" :former-content="formerContent"></hint>
      <customTextarea
        :index="index"
        :content="content"
        :statistic="statistic"
      >
      </customTextarea>
    </div>
  </script>

  <script type="x-template" id="hint">
    <div>
      <p>{{ desc.main }}</p>
      <p>{{ formerContent }}</p>
      <ul>
        <li v-for="supplement in desc.supplements" >{{ supplement }}</li>
      </ul>
    </div>
  </script>

  <script type="x-template" id="customTextarea">
    <div>
      <p v-if="innerStatistic.expected">{{innerStatistic.actual}} / {{innerStatistic.expected}}</p>
      <textarea @input="handleInput" v-model="innerContent"></textarea>
    </div>
  </script>

  <script type="x-template" id="charactors">
    <div>
      <button @click="$emit('add')">新增</button>
      <div v-for="(charactor, index) in charactors" :key="index">
        <span>name: <input type="text" v-model="charactor.name"></span>
        <span>age: <input type="text" v-model="charactor.age"></span>
        <button @click="$emit('delete', index)">删除</button>
      </div>
    </div>
  </script>

  <script>
    Vue.component('side-nav', {
      props: ['steps', 'selected'],
      template: '\
        <ul>\
          <li v-for="(step, index) in steps">\
            <button @click="$emit(\'selected\', index)" :class="{ selected : selected == index }" >{{ index + 1 }}</button>\
          </li>\
        </ul>\
      '
    });

    Vue.component('hint', {
      props: ['desc', 'statistic' , 'formerContent'],
      template: '#hint'
    });

    Vue.component('charactors', {
      props: ['charactors'],
      template: '#charactors'
    });

    Vue.component('customTextarea', {
      props: ['index', 'content', 'statistic'],
      template: '#customTextarea',
      data: function(){
        return {
          innerContent: this.content,
          innerStatistic: Object.assign({},this.statistic)
        }
      },
      methods: {
        handleInput: function(event){
          this.resetHeight(event);
          this.innerStatistic['actual'] = this.innerContent.trim().length;
          console.log(this.$parent)
          this.$parent.$emit('update-content', this.index, (this.innerContent).trim());
        },
        resetHeight: function(event){
          event.target.style.height = 'auto';
          event.target.style.height = (event.target.scrollHeight) + 'px';
        }
      }
    });

    new Vue({
      el: '#app',
      components: {
        one: {
          template: '#type_1',
          props: ['index', 'content', 'formerContent'],
          data: function(){
            return {
              desc: {
                main: '用一句话总结小说的内容',
                supplements: ['长度不超过 30 个字']
              },
              statistic: {
                actual: 0,
                expected: 30
              }
            }
          }
        },
        two: {
          template: '#type_1',
          props: ['index', 'content', 'formerContent'],
          data: function(){
            return {
              desc: {
                main: '把第 1 步写的话扩写成一段话：',
                supplements: ['这段话包含 5 个句子：','故事开头（1句）','主角经受的主要磨难（3句）','以及结尾（1句）']
              },
              statistic: {
                actual: 0,
                expected: 100
              }
            }
          }
        }
      },
      data: {
        steps: [{
          name: 'one',
          former: -1,
          content: ''
        },{
          name: 'two',
          former: 0,
          content: ''
        }
//        ,{
//          num: 3,
//          name: '3',
//          desc: {
//            main: '塑造主要人物',
//            supplements: ['每个主要角色都应该有以下内容：','姓名','一句话总结的角色故事情节','角色的动机（偏向于抽象的）','角色的目标（偏向于具体的）','阻碍角色达到目标的事物', '角色最终的感悟','一段话总结的角色故事情节']
//          },
//          statistic: {
//            actual: 0,
//            expected: 0
//          },
//          charactors: [{
//            name: '',
//            age: null
//          }]
//        },{
//          num: 4,
//          name: '4',
//          desc: {
//            main: '扩写上面那段故事梗概',
//            supplements: ['将内容扩充到一页纸（800 字）']
//          },
//          statistic: {
//            actual: 0,
//            expected: 800
//          }
//        },{
//          num: 5,
//          name: '5',
//          desc: {
//            main: '描述故事的每个角色',
//            supplements: ['为每个主要角色写上一页纸（800 字）的描述','为其他重要角色也写上半页（400 字）描述','要从每个角色的角度去描述整个故事']
//          },
//          statistic: {
//            actual: 0,
//            expected: 100
//          }
//        },{
//          num: 6,
//          name: '6',
//          desc: {
//            main: '继续扩写故事梗概',
//            supplements: ['将一页纸的故事概述，扩写成四页（3200 字）']
//          },
//          statistic: {
//            actual: 0,
//            expected: 3200
//          }
//        },{
//          num: 7,
//          name: '7',
//          desc: {
//            main: '完善每个角色的所有资料',
//            supplements: ['在故事的末尾，角色有了什么样的转变、收获']
//          },
//          statistic: {
//            actual: 0,
//            expected: 100
//          }
//        },{
//          num: 8,
//          name: '8',
//          desc: {
//            main: '罗列出所有故事场景的概述',
//            supplements: ['把 3200 字的故事梗概拆分成一幕幕的故事场景','每个场景的信息包含：出场人物、故事、篇幅（大约写多少字）']
//          },
//          statistic: {
//            actual: 0,
//            expected: 100
//          }
//        },{
//          num: 9,
//          name: '9',
//          desc: {
//            main: '扩写每一条场景',
//            supplements: ['把每一条场景扩写成一段话','要在每一段中出现冲突，如果做不到，就去掉那条场景']
//          },
//          statistic: {
//            actual: 0,
//            expected: 100
//          }
//        },{
//          num: 10,
//          name: '10',
//          desc: {
//            main: '写初稿',
//            supplements: []
//          },
//          statistic: {
//            actual: 0,
//            expected: 100
//          }
//        },{
//          num: 11,
//          name: '11',
//          desc: {
//            main: '完善作品',
//            supplements: []
//          },
//          statistic: {
//            actual: 0,
//            expected: 100
//          }
//        }
],
        selected: 0
      },
      methods: {
        setSelected: function(step){
          this.selected = step;
        },

        updateContent: function(index, content){
          console.log(index)
          this.steps[index]['content'] = content;
        },

        addCharactor: function(){
          var charactor = {
            name: '',
            age: null
          };
          this.steps[2]['charactors'].push(charactor);
        },

        deleteCharactor: function(index){
          this.steps[2]['charactors'].splice(index, 1);
        }

      }
    });
  </script>
</body>
</html>